{% extends 'layout.html' %} 

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">

  <div>
      <h1 class="text-2xl font-bold text-gray-800 dark:text-white">KELOLA PENGHUNI</h1>
      <p class="text-gray-500 dark:text-gray-400 text-sm mt-1">
        Tambah, edit, dan kelola data penghuni dalam satu halaman.
      </p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
    
    <div class="lg:col-span-1">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border sticky top-24 transition-all duration-300
                    {{ 'border-yellow-400 ring-2 ring-yellow-100 dark:ring-yellow-900/50' if edit_mode else 'border-gray-100 dark:border-gray-700' }}">
            
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2 {{ 'text-yellow-600 dark:text-yellow-500' if edit_mode else 'text-gray-800 dark:text-white' }}">
                {% if edit_mode %}
                    <i data-feather="edit-3" class="w-5 h-5"></i> Edit {{ penghuni_edit.nama }}
                {% else %}
                    <i data-feather="user-plus" class="w-5 h-5 text-blue-500"></i> Tambah Penghuni
                {% endif %}
            </h2>
            
            <form method="POST" 
                  action="{{ url_for('admin.edit_penghuni', id=penghuni_edit.id) if edit_mode else url_for('admin.kelola_penghuni') }}" 
                  class="space-y-4">
              
              {{ form.hidden_tag() }}
              
              <div class="p-3 rounded-xl space-y-3 border border-gray-500 dark:border-gray-600 bg-gray-50 dark:bg-gray-700/50">
                  <p class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1">Akun Login</p>
                  <div>
                    {{ form.username(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none", placeholder="Username") }}
                  </div>
                  <div>
                    {{ form.email(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none", placeholder="Email") }}
                  </div>
                  <div>
                    {{ form.password(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none", placeholder="Password Baru" if not edit_mode else "Password (Opsional)") }}
                  </div>
              </div>

              <div class="space-y-3">
                  <div>
                    {{ form.nama_lengkap.label(class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1") }}
                    {{ form.nama_lengkap(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none") }}
                  </div>

                  <div class="grid grid-cols-2 gap-2">
                      <div>
                        {{ form.no_hp.label(class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1") }}
                        {{ form.no_hp(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none") }}
                      </div>
                      <div>
                        {{ form.jenis_kelamin.label(class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1") }}
                        {{ form.jenis_kelamin(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none") }}
                      </div>
                  </div>

                  <div>
                    <style>
                        .date-icon-blue::-webkit-calendar-picker-indicator {
                            filter: invert(32%) sepia(98%) saturate(1917%) hue-rotate(206deg) brightness(98%) contrast(102%);
                            cursor: pointer;
                        }
                        .dark .date-icon-blue { color-scheme: light; }
                    </style>
                    {{ form.tanggal_masuk.label(class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1") }}
                    {{ form.tanggal_masuk(class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none date-icon-blue", type="date") }}
                  </div>

                  <div>
                    {{ form.alamat.label(class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1") }}
                    {{ form.alamat(rows=2, class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none") }}
                  </div>
              </div>

              <div class="flex gap-2 pt-2">
                  {% if edit_mode %}
                    <button type="submit" class="flex-1 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-xl font-bold shadow-md transform active:scale-95 transition-all">Simpan</button>
                    <a href="{{ url_for('admin.kelola_penghuni') }}" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition">Batal</a>
                  {% else %}
                    <button type="submit" class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-md transform active:scale-95 transition-all">Tambah Data</button>
                  {% endif %}
              </div>

            </form>
        </div>
    </div>

    <div class="lg:col-span-2 space-y-4">
        {% if semua_penghuni %}
            <div class="grid grid-cols-1 gap-4">
                {% for p in semua_penghuni %}
                <div class="group bg-white dark:bg-gray-800 p-5 rounded-2xl border shadow-sm transition-all duration-200 hover:shadow-md
                            {{ 'border-yellow-400 ring-2 ring-yellow-100 dark:ring-yellow-900/30 bg-yellow-50/50 dark:bg-yellow-900/10' if edit_mode and penghuni_edit.id == p.id else 'border-gray-100 dark:border-gray-700' }}">
                    
                    <div class="flex justify-between items-start">
                        <div class="flex items-start gap-4">
                            <div class="rounded-full bg-gray-200 overflow-hidden border border-gray-100 dark:border-gray-600 flex-shrink-0">
                                {% if p.user.profile_photo %}
                                    <img src="{{ url_for('static', filename=p.user.profile_photo) }}" class="object-cover w-24 h-24">
                                {% else %}
                                    <img src="{{ url_for('static', filename='img/default-avatar.jpeg') }}" class="object-cover w-24 h-24">
                                {% endif %}
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                    {{ p.nama }}
                                    {% if p.jenis_kelamin == 'L' %}
                                        <i data-feather="user" class="w-3 h-3 text-blue-500 fill-blue-500"></i>
                                    {% else %}
                                        <i data-feather="user" class="w-3 h-3 text-pink-500 fill-pink-500"></i>
                                    {% endif %}
                                </h3>
                                <div class="text-sm text-gray-500 dark:text-gray-400 space-y-0.5">
                                    <p class="flex items-center gap-2"><i data-feather="mail" class="w-3 h-3"></i> {{ p.user.email }}</p>
                                    <p class="flex items-center gap-2"><i data-feather="phone" class="w-3 h-3"></i> {{ p.no_hp }}</p>
                                </div>
                            </div>
                        </div>

                        <div class="text-right">
                            {% if p.kamar %}
                                <span class="px-3 py-1 bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400 text-xs font-bold rounded-lg">
                                    Kamar {{ p.kamar.nomor_kamar }}
                                </span>
                            {% else %}
                                <span class="px-3 py-1 bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400 text-xs font-bold rounded-lg">
                                    Belum Ada Kamar
                                </span>
                            {% endif %}
                            <p class="text-[10px] text-gray-400 mt-1">Masuk: {{ p.tanggal_masuk.strftime('%d %b %Y') }}</p>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 pt-4 mt-2 border-t border-gray-50 dark:border-gray-700/50 opacity-0 group-hover:opacity-100 transition-opacity">
                        <a href="{{ url_for('admin.edit_penghuni', id=p.id) }}" 
                           class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-yellow-600 bg-yellow-50 hover:bg-yellow-100 dark:bg-yellow-900/20 dark:hover:bg-yellow-900/40 rounded-lg transition">
                            <i data-feather="edit-2" class="w-3 h-3"></i> Edit
                        </a>
                        
                        <form method="POST" action="{{ url_for('admin.hapus_penghuni', id=p.id) }}" onsubmit="return confirm('Hapus {{ p.nama }}? Akun login juga akan terhapus.');">
                            {{ form.hidden_tag() }}
                            <button type="submit" class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-red-600 bg-red-50 hover:bg-red-100 dark:bg-red-900/20 dark:hover:bg-red-900/40 rounded-lg transition">
                                <i data-feather="trash-2" class="w-3 h-3"></i> Hapus
                            </button>
                        </form>
                    </div>

                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-white dark:bg-gray-800 rounded-2xl border border-dashed border-gray-300 dark:border-gray-700 p-12 text-center flex flex-col items-center justify-center">
                <i data-feather="users" class="w-8 h-8 text-gray-400 mb-4 opacity-50"></i>
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">Belum ada data penghuni</h3>
                <p class="text-gray-500 text-sm">Gunakan formulir di kiri untuk menambah penghuni baru.</p>
            </div>
        {% endif %}
    </div>

  </div>
</div>

<script>feather.replace();</script>
{% endblock %}