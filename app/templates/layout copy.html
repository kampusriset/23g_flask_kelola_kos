<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ title if title else "MyKost" }}</title>
  
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/logo.svg') }}">
  
  <link href="{{ url_for('static', filename='css/styles.css') }}?v=2" rel="stylesheet">
  <script src="{{ url_for('static', filename='js/feather.min.js') }}"></script>
  
  <style>
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>

  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }
  </script>
</head>

<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100 font-sans antialiased overflow-hidden transition-colors duration-300">

  {% set nav_active = "bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400" %}
  
  {% set nav_inactive = "text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-white" %}

  <div class="flex h-screen w-full">

    <aside class="hidden md:flex flex-col w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 h-full transition-colors duration-300">
      
      <div class="p-6 flex items-center gap-3 mb-2">
        <a href="{{ url_for(current_user.role ~ '.dashboard') }}" class="flex items-center gap-3">
          <img src="{{ url_for('static', filename='img/logo.svg') }}" class="w-9 h-9 object-contain">
          <h1 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">MyKost</h1>
        </a>
      </div>

      <nav class="flex-1 overflow-y-auto px-4 space-y-1 mt-2 no-scrollbar">
        
        <a href="{{ url_for('admin.dashboard')}}" 
           class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.dashboard' else nav_inactive }}">
          <i data-feather="home" class="w-5 h-5"></i> <span>Home</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.jadwal' else nav_inactive }}">
          <i data-feather="calendar" class="w-5 h-5"></i> <span>Jadwal</span>
        </a>

        <a href="{{ url_for('admin.create_penghuni') }}" 
           class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.create_penghuni' else nav_inactive }}">
          <i data-feather="key" class="w-5 h-5"></i> <span>Kamar</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.pembayaran' else nav_inactive }}">
          <i data-feather="credit-card" class="w-5 h-5"></i> <span>Pembayaran</span>
        </a>

        <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.pengaduan' else nav_inactive }}">
          <i data-feather="archive" class="w-5 h-5"></i> <span>Pengaduan</span>
        </a>

        <a href="{{ url_for('admin.pengumuman') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.pengumuman' else nav_inactive }}">
          <i data-feather="tag" class="w-5 h-5"></i> <span>Pengumuman</span>
        </a>

        <a href="{{ url_for('admin.peraturan') }}" 
           class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.peraturan' else nav_inactive }}">
          <i data-feather="list" class="w-5 h-5"></i> <span>Peraturan</span>
        </a>

      </nav>

      <div class="p-4 border-t border-gray-100 dark:border-gray-700 space-y-1">
        <a href="#" class="flex items-center gap-3 px-4 py-3 text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-white rounded-xl font-medium transition">
           <i data-feather="user" class="w-5 h-5"></i> <span>Profile</span>
        </a>
        <a href="{{ url_for('auth.login') }}" class="flex items-center gap-3 px-4 py-3 text-red-500 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl font-medium transition">
           <i data-feather="log-out" class="w-5 h-5"></i> <span>Logout</span>
        </a>
      </div>
    </aside>


    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        
        <header class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-md md:bg-white md:dark:bg-gray-800 p-4 md:px-8 md:py-6 flex justify-between items-center sticky top-0 z-20 transition-colors duration-300 shadow-sm dark:shadow-none dark:border-b dark:border-gray-700">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-white">
                Halo, {{ current_user.role|capitalize }}!
            </h2>

            <div class="flex items-center gap-3">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition focus:outline-none">
                    <i id="theme-icon-moon" data-feather="moon" class="w-6 h-6 hidden"></i> 
                    <i id="theme-icon-sun" data-feather="sun" class="w-6 h-6 hidden"></i> 
                </button>

                <button class="relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-600 dark:text-gray-300">
                    <i data-feather="bell" class="w-6 h-6"></i>
                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white dark:border-gray-800"></span>
                </button>
                
                <div class="w-9 h-9 rounded-full bg-gray-200 border border-gray-300 dark:border-gray-600 overflow-hidden">
                    <img src="https://ui-avatars.com/api/?name=User&background=random" alt="Profil">
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:px-8 md:pb-8 pb-24 no-scrollbar">
            {% block content %}
            {% endblock %}
        </div>
    </main>

  </div>


  <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex justify-around items-center py-3 z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] transition-colors duration-300">
      <a href="{{ url_for('admin.dashboard') }}" 
         class="flex flex-col items-center gap-1 {{ 'text-blue-600 dark:text-blue-400' if request.endpoint == 'admin.dashboard' else 'text-gray-400 hover:text-blue-600 dark:hover:text-blue-400' }}">
        <i data-feather="home" class="w-6 h-6"></i>
        <span class="text-[10px] font-medium">Home</span>
      </a>
      <a href="{{ url_for('admin.create_penghuni') }}" 
         class="flex flex-col items-center gap-1 {{ 'text-blue-600 dark:text-blue-400' if request.endpoint == 'admin.create_penghuni' else 'text-gray-400 hover:text-blue-600 dark:hover:text-blue-400' }}">
        <i data-feather="key" class="w-6 h-6"></i>
        <span class="text-[10px] font-medium">Kamar</span>
      </a>
      <a href="{{ url_for('admin.peraturan') }}" 
         class="flex flex-col items-center gap-1 {{ 'text-blue-600 dark:text-blue-400' if request.endpoint == 'admin.peraturan' else 'text-gray-400 hover:text-blue-600 dark:hover:text-blue-400' }}">
        <i data-feather="list" class="w-6 h-6"></i>
        <span class="text-[10px] font-medium">Aturan</span>
      </a>
      <a href="{{ url_for('admin.pengumuman') }}" 
         class="flex flex-col items-center gap-1 {{ 'text-blue-600 dark:text-blue-400' if request.endpoint == 'admin.pengumuman' else 'text-gray-400 hover:text-blue-600 dark:hover:text-blue-400' }}">
        <i data-feather="list" class="w-6 h-6"></i>
        <span class="text-[10px] font-medium">Pengumuman</span>
      </a>
      <button onclick="toggleDrawer()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-gray-800 dark:hover:text-white transition focus:outline-none">
        <i data-feather="menu" class="w-6 h-6"></i>
        <span class="text-[10px] font-medium">Menu</span>
      </button>
  </nav>

  <div id="drawer-overlay" class="fixed inset-0 bg-black/50 z-40 hidden transition-opacity backdrop-blur-sm" onclick="toggleDrawer()"></div>
  
  <div id="drawer-menu" class="fixed top-0 right-0 w-72 h-full bg-white dark:bg-gray-800 z-50 transform translate-x-full transition-transform duration-300 ease-in-out shadow-2xl flex flex-col border-l dark:border-gray-700">
      <div class="p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800">
          <a href="{{ url_for(current_user.role ~ '.dashboard') }}"" class="flex items-center gap-3">
            <img src="{{ url_for('static', filename='img/logo.svg') }}" class="w-9 h-9 object-contain">
            <h1 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">MyKost</h1>
          </a>
          <button onclick="toggleDrawer()" class="text-gray-500 dark:text-gray-400 hover:text-red-500"><i data-feather="x"></i></button>
      </div>
      
      <div class="flex-1 overflow-y-auto p-4 space-y-2 no-scrollbar">
          <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-2">Fitur Utama</p>
          
          <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.jadwal' else nav_inactive }}">
             <i data-feather="calendar" class="w-4 h-4"></i> Jadwal
          </a>
          <a href="{{ url_for('admin.create_penghuni') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.create_penghuni' else nav_inactive }}">
             <i data-feather="key" class="w-4 h-4"></i> Kamar
          </a>
          <a href="{{ url_for('admin.pengumuman') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.pengumuman' else nav_inactive }}">
             <i data-feather="tag" class="w-4 h-4"></i> Pengumuman
          </a>
          <a href="{{ url_for('admin.peraturan') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition {{ nav_active if request.endpoint == 'admin.peraturan' else nav_inactive }}">
             <i data-feather="list" class="w-4 h-4"></i> Peraturan
          </a>
          
          <div class="border-t border-gray-100 dark:border-gray-700 my-2 pt-2">
              <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-2">Akun Saya</p>
              <a href="{{ url_for('auth.login') }}" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400 font-medium transition">
                  <i data-feather="log-out" class="w-4 h-4"></i> Logout
              </a>
          </div>
      </div>
  </div>

  <script>
    feather.replace();

    function toggleDrawer() {
        const overlay = document.getElementById('drawer-overlay');
        const menu = document.getElementById('drawer-menu');
        const body = document.body;

        if (menu.classList.contains('translate-x-full')) {
            overlay.classList.remove('hidden');
            menu.classList.remove('translate-x-full');
            body.style.overflow = 'hidden'; 
        } else {
            overlay.classList.add('hidden');
            menu.classList.add('translate-x-full');
            body.style.overflow = '';
        }
    }

    const themeToggleBtn = document.getElementById('theme-toggle');
    const iconMoon = document.getElementById('theme-icon-moon');
    const iconSun = document.getElementById('theme-icon-sun');

    function updateIcons() {
        if (document.documentElement.classList.contains('dark')) {
            iconMoon.classList.add('hidden');
            iconSun.classList.remove('hidden');
        } else {
            iconMoon.classList.remove('hidden');
            iconSun.classList.add('hidden');
        }
    }

    updateIcons();

    themeToggleBtn.addEventListener('click', function() {
        if (document.documentElement.classList.contains('dark')) {
            document.documentElement.classList.remove('dark');
            localStorage.theme = 'light';
        } else {
            document.documentElement.classList.add('dark');
            localStorage.theme = 'dark';
        }
        updateIcons();
    });
  </script>
</body>
</html>